!function(e){"use strict";CherryJsCore.utilites.namespace("cherryRealEstate"),CherryJsCore.cherryRealEstate={magnificPopup:null,start:function(){var e=this;CherryJsCore.status.is_ready?e.documentReady(e):CherryJsCore.variable.$document.on("ready",e.documentReady(e))},documentReady:function(e){var e=e;e.gallery(e),e.popup(e),e.submissionForm(e),e.loginForm(e),e.registerForm(e),e.uploadImages(e),e.previewLayouts(e),e.sort(e),e.location(e)},gallery:function(){function a(e,a){var r=e.data("id");return a=a||e.data("atts"),new Swiper("#"+r,a)}e(".tm-property-gallery-js").each(function(){var r=e(this),s=r.data("atts");if(!e.isFunction(jQuery.fn.swiper)||!r.length)return!1;if(s.hasOwnProperty("group")){var t,n=s.group,o={};for(t in n)o[t]=a(e(n[t]));o.top.params.control=o.thumbs,o.thumbs.params.control=o.top}else a(r,s)})},submissionForm:function(){function a(a){var r=a.serializeArray(),i=a.find(".tm-re-uploaded-ids"),l=a.find(".tm-re-uploaded-images"),d=i.data("ids"),u=a.find('input[name="tm-re-submissionform-nonce"]').val(),m="processing";return a.hasClass(m)?!1:(a.addClass(m),s.empty(),s.hasClass(o)||s.addClass(o),t.hasClass(o)||t.addClass(o),void e.ajax({url:CherryREData.ajaxurl,type:"post",dataType:"json",data:{action:"submission_form",nonce:u,property:r,gallery:d},beforeSend:function(){n.removeClass(o)},error:function(e,r){a.removeClass(m),s.removeClass(o).html(r),n.addClass(o)}}).done(function(e){return a.removeClass(m),n.addClass(o),!0===e.success?(t.removeClass(o),a[0].reset(),l.empty(),i.data("ids",[]),1):(s.removeClass(o).html(e.data.message),!1)}))}var r=e("#tm-re-submissionform");if(!e.isFunction(jQuery.fn.validate)||!r.length)return!1;var s=r.find(".tm-re-submission-form__error"),t=r.find(".tm-re-submission-form__success"),n=r.find(".tm-re-submission-form__process"),o="tm-re-hidden";r.validate({debug:!0,messages:{property_title:CherryREData.messages,property_description:CherryREData.messages,property_price:CherryREData.messages,property_bedrooms:CherryREData.messages,property_bathrooms:CherryREData.messages,property_area:CherryREData.messages,property_parking_places:CherryREData.messages,property_address:CherryREData.messages},rules:{property_price:{number:!0},property_area:{number:!0},property_bedrooms:{digits:!0},property_bathrooms:{digits:!0},property_parking_places:{digits:!0}},errorElement:"span",onkeyup:!1,onfocusout:function(e){this.checkable(e)||!(e.name in this.submitted)&&this.optional(e)||this.element(e),s.hasClass(o)||s.addClass(o),t.hasClass(o)||t.addClass(o)},highlight:function(a,r,s){e(a).fadeOut(function(){e(a).fadeIn().addClass(r).removeClass(s)})},unhighlight:function(a,r,s){e(a).removeClass(r).addClass(s)},invalidHandler:function(){s.hasClass(o)||s.addClass(o),t.hasClass(o)||t.addClass(o)},submitHandler:function(r){a(e(r))}})},loginForm:function(){function a(a){var r=a.find(".tm-re-login-form__error"),s=a.find(".tm-re-login-form__success"),t=a.find('input[name="user_login"]').val(),n=a.find('input[name="user_pass"]').val(),o=a.find('input[name="tm-re-loginform-nonce"]').val(),i="processing",l="tm-re-hidden";return a.hasClass(i)?!1:(a.addClass(i),r.empty(),r.hasClass(l)||r.addClass(l),s.hasClass(l)||s.addClass(l),void e.ajax({url:CherryREData.ajaxurl,type:"post",dataType:"json",data:{action:"login_form",nonce:o,access:{login:t,pass:n}},error:function(e,s){a.removeClass(i),r.removeClass(l).html(s)}}).done(function(e){return a.removeClass(i),!0===e.success?(s.removeClass(l),CherryJsCore.variable.$document[0].location.reload(!0),1):(r.removeClass(l).html(e.data.message),!1)}))}var r=e("#tm-re-loginform");return e.isFunction(jQuery.fn.validate)&&r.length?void r.validate({debug:!0,messages:{user_login:CherryREData.messages,user_pass:CherryREData.messages},errorElement:"span",onkeyup:!1,highlight:function(a,r,s){e(a).fadeOut(function(){e(a).fadeIn().addClass(r).removeClass(s)})},unhighlight:function(a,r,s){e(a).removeClass(r).addClass(s)},submitHandler:function(r){a(e(r))}}):!1},registerForm:function(a){function r(r){var s=r.find(".tm-re-register-form__error"),t=r.find(".tm-re-register-form__success"),n=r.find('input[name="user_login"]').val(),o=r.find('input[name="user_email"]').val(),i=r.find('input[name="tm-re-registerform-nonce"]').val(),l="processing",d="tm-re-hidden";return r.hasClass(l)?!1:(r.addClass(l),s.empty(),s.hasClass(d)||s.addClass(d),t.hasClass(d)||t.addClass(d),void e.ajax({url:CherryREData.ajaxurl,type:"post",dataType:"json",data:{action:"register_form",nonce:i,access:{login:n,email:o}},error:function(e,a){r.removeClass(l),s.removeClass(d).html(a)}}).done(function(n){return r.removeClass(l),!0===n.success?(t.removeClass(d),e.isFunction(jQuery.fn.magnificPopup)&&null!==a.magnificPopup&&a.magnificPopup.close(),1):(s.removeClass(d).html(n.data.message),!1)}))}var s=e("#tm-re-registerform");return e.isFunction(jQuery.fn.validate)&&s.length?void s.validate({debug:!0,messages:{user_login:CherryREData.messages,user_email:CherryREData.messages},errorElement:"span",onkeyup:!1,highlight:function(a,r,s){e(a).fadeOut(function(){e(a).fadeIn().addClass(r).removeClass(s)})},unhighlight:function(a,r,s){e(a).removeClass(r).addClass(s)},submitHandler:function(a){r(e(a))}}):!1},popup:function(a){function r(r){r.preventDefault();var s=e(this).data("tab"),n=e(t).data("anim-effect");a.magnificPopup.open({items:{src:t},type:"inline",preloader:!1,removalDelay:500,mainClass:n,callbacks:{beforeOpen:function(){var r=e(t).find("form"),n="tm-re-hidden";r.length&&r.each(function(a,r){e(r).find(".tm-re-messages span").addClass(n),r.reset()}),a.tabs(a,s)}}})}var s=".tm-re-popup",t="#"+CherryREData.popupid;return e(t).length&&e.isFunction(jQuery.fn.magnificPopup)&&e(s).length?(a.magnificPopup=e.magnificPopup.instance,void CherryJsCore.variable.$document.on("click",s,r)):!1},tabs:function(a,r){var s=e("#"+CherryREData.popupid);return e.isFunction(jQuery.fn.tabs)&&s.length?void s.tabs({collapsible:!1,active:r}):!1},uploadImages:function(){e(".tm-re-uploaded-btn__field").each(function(){function a(a){a.preventDefault(),e(this).closest(".tm-re-uploaded-images__item").remove()}function r(a){var r=e(this),s=r.closest(".tm-re-uploaded-images__item"),n=s.find(".tm-re-status--process"),i=s.find(".tm-re-uploaded-image__remove"),l=r.data();a.preventDefault(),n.removeClass(p),i.remove(),t.addClass(m),o.prop("disabled",!0),r.prop("disabled",!0),l.submit()}var s=e(this);if(!e.isFunction(jQuery.fn.fileupload)||!s.length)return!1;var t=s.parents("form"),n=t.find(".tm-re-uploaded-images"),o=t.find('button[type="submit"]'),i=t.find(".tm-re-uploaded-ids"),l=t.find('input[name="tm-re-submissionform-nonce"]').val(),d=s.attr("name"),u=(s.attr("multiple")?1:0,s.data("file_types")),m="processing",p="tm-re-hidden";return t.hasClass(m)?!1:(s.fileupload({url:CherryREData.ajaxurl,type:"post",dataType:"json",singleFileUploads:!0,dropZone:s,autoUpload:!1,previewMaxWidth:150,previewMaxHeight:150,previewCrop:!0,formData:{nonce:l,name:d,action:"upload_file",script:!0}}).on("fileuploadadd",function(a,r){var s=[],t=e.parseHTML(CherryREData.js_field_html_img);if(r.context=e(t),u){var o=new RegExp("(.|/)("+u+")$","i");r.files[0].name.length&&!o.test(r.files[0].name)&&s.push(CherryREData.messages.invalid_file_type+" "+u)}s.length>0?alert(s.join("\n")):e.each(r.files,function(e,a){var s=r.context.find(".tm-re-uploaded-image__name"),t=r.context.find(".tm-re-uploaded-image__btn");s.text(a.name),t.data(r),r.context.appendTo(n)})}).on("fileuploadprocessalways",function(a,r){if(!e(r.context).length)return!1;var s=r.index,t=r.files[s],n=e(r.context.children()[s]);t.preview&&n.prepend(t.preview),t.error&&n.append("<br>").append(e('<span class="text-danger"/>').text(t.error)),s+1===r.files.length&&r.context.find("button").prop("disabled",!!r.files.error)}).on("fileuploaddone",function(a,r){var s=u.split("|"),n=r.result,l=r.context.find(".tm-re-status--process"),d=r.context.find(".tm-re-status--error"),c=r.context.find(".tm-re-status--success");return t.removeClass(m),l.addClass(p),o.prop("disabled",!1),!1===n.success?(alert(n.data.message),d.removeClass(p),!1):void e.each(n.data.files,function(a,t){if(t.error)return alert(t.error),d.removeClass(p),-1;var n=i.data("ids");return-1==e.inArray(t.extension,s)?(d.removeClass(p),-1):(n.push(t.id),i.data("ids",n),c.removeClass(p),void r.context.find("button").remove())})}),CherryJsCore.variable.$document.on("click",".tm-re-uploaded-image__remove",a),void CherryJsCore.variable.$document.on("click",".tm-re-uploaded-image__btn",r))})},previewLayouts:function(){function a(a){var t=e(a.target),n=t.parents("form"),o=n.find('input[name="tm-re-switch-layout-nonce"]').val(),i=t.val(),l="tm-re-switch-layout__btn--active",d="grid list",u="processing";return t.hasClass(l)?!1:n.hasClass(u)?!1:(n.addClass(u),s.addClass(u),void e.ajax({url:CherryREData.ajaxurl,type:"post",dataType:"json",data:{action:"switch_layout",layout:i,nonce:o},beforeSend:function(){r.hasClass(l)&&r.removeClass(l),t.addClass(l)},error:function(){n.removeClass(u),s.removeClass(u)}}).done(function(){n.removeClass(u),s.removeClass(u),s.toggleClass(d)}))}var r=e(".tm-re-switch-layout__btn"),s=e("#tm-re-property-items");return r.length&&s.length?void r.on("click",a):!1},sort:function(a){function r(){var r=CherryJsCore.variable.$window[0].location.search,s=a.getQueryParameters(r);s.properties_sort=e(this).val(),CherryJsCore.variable.$window[0].location.search=e.param(s)}var s=e("#tm-re-property-sort"),t=s.find("select");return t.length?void t.on("change",r):!1},getQueryParameters:function(e){return(e||document.location.search).replace(/(^\?)/,"").split("&").map(function(e){return e=e.split("="),this[e[0]]=e[1],this}.bind({}))[0]},location:function(){e(".tm-re-map").each(function(){var a,r=e(this).data("atts");return"object"!=typeof r?!1:(a=e("#"+r.id),e.isFunction(jQuery.fn.RELocations)&&a.length?void a.RELocations(r):!1)})}},CherryJsCore.cherryRealEstate.start()}(jQuery);