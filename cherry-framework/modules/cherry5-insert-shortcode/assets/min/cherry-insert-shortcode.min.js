jQuery(document).on("ready",function(){var t=jQuery,e=window.CherryJsCore;e.utilites.namespace("cherry5InsertShortcode"),e.cherry5InsertShortcode={openPopUpButton:".cherry5-is__open-button",closePopUpButton:".cherry5-is__close-button",insertionWindow:".cherry5-is__modal-window",insertionPopUp:".cherry5-is__popup",insertionPopUpBg:".cherry5-is__background",shortcodeOptionHolder:".cherry5-is__shortcodes-options",shortcodeOptionHolderClass:".cherry5-is__shortcode-form.show",insertButton:".cherry5-is__insert-button",spinner:".cherry-loader-wrapper",contentArea:".cherry5-is__shortcode-content",sidebar:".cherry5-is__popup-sidebar",sidebarButton:".cherry5-is__sidebar-button",insertShortcodeId:"cherry5_insert_shortcode",getShortcodeOptionButton:".cherry5-is__get-shotcode",getShortcodeOptionInstance:null,selectedContent:"",openedShortcode:[],devMode:!1,sessionStorage:{optionsTemplate:{},activeShortcode:{}},init:function(){this.devMode="true"===window.cherry5InsertShortcode.devMode,this.sessionStorage=this.devMode?this.sessionStorage:this.getState()||this.sessionStorage,this.getShortcodeOptionInstance=new e.CherryAjaxHandler({handlerId:this.insertShortcodeId,successCallback:this.getShortcodeOptionCallback.bind(this)}),this.addEvent(),this.switchFirstShortcode()},addEvent:function(){t("body").on("click.cherry5InsertShortcode",this.openPopUpButton,this.showPopUp.bind(this)).on("click.cherry5InsertShortcode",this.closePopUpButton,this.hidePopUp.bind(this)).on("click.cherry5InsertShortcode",this.insertionPopUpBg,this.hidePopUp.bind(this)).on("click.cherry5InsertShortcode",this.insertButton,this.insertShortcode.bind(this)).on("click.cherry5InsertShortcode",this.insertButton,this.hidePopUp.bind(this)).on("click.cherry5InsertShortcode",this.getShortcodeOptionButton,this.getShortcodeOption.bind(this)).on("click.cherry5InsertShortcode",this.sidebarButton,this.openSodebar.bind(this))},showPopUp:function(){var e;window.tinymce&&(window.tinymce.get("content")&&window.tinymce.get("content").selection&&(this.selectedContent=window.tinymce.get("content").selection.getContent({format:"text"})),e=this.sessionStorage.activeShortcode,this.afterShowShortcode(e.pluginSlug+"-"+e.shortcodeSlug,e.enclosing)),t(this.insertionWindow).addClass("open show"),t(this.insertionPopUp,this.insertionWindow).off("animationend")},hidePopUp:function(){this.selectedContent="",this.openedShortcode=[],t(this.insertionWindow).removeClass("open"),t(this.insertionPopUp,this.insertionWindow).on("animationend",this.hideModalWindow.bind(this))},hideModalWindow:function(){t(this.insertionWindow).removeClass("show")},switchFirstShortcode:function(){var e=this.sessionStorage.activeShortcode,o=null;o=t(e.pluginSlug&&e.shortcodeSlug?"#button-"+e.pluginSlug+"-"+e.shortcodeSlug:".cherry5-is__shortcode-list:first > li:first .cherry5-is__get-shotcode"),this.switchShortcode(o)},getShortcodeOption:function(e){return this.switchShortcode(t(e.target)),!1},switchShortcode:function(e){var o,i=e.data("plugin-slug"),s=e.data("shortcode-slug"),n=i+"-"+s,r=t("#"+n);return t(this.insertButton,this.insertionPopUp).attr("disabled","disabled"),this.hide(t(this.getShortcodeOptionButton+".show")),this.show(e),this.hide(t(this.shortcodeOptionHolderClass)),r[0]?(o=this.sessionStorage.optionsTemplate[n],this.setProxyStorage(o,n),this.show(r),void this.afterShowShortcode(n,o.enclosing)):!this.devMode&&this.sessionStorage.optionsTemplate[n]?void this.getShortcodeOptionCallback({data:this.sessionStorage.optionsTemplate[n]}):(this.show(t(this.spinner,this.shortcodeOptionHolder)),void this.getShortcodeOptionInstance.sendData({plugin_slug:i,shortcode_slug:s}))},getShortcodeOptionCallback:function(e){var o,i=e.data,s=t(this.shortcodeOptionHolder,"body");return i.error?void window.console.log(i.message):(o=i.pluginSlug+"-"+i.shortcodeSlug,this.setProxyStorage(i,o),this.hide(t(this.spinner,this.shortcodeOptionHolder)),s.append(i.html),this.afterShowShortcode(o,i.enclosing),t(document).trigger("cherryInterfaceBuilder"),void t("body").trigger({type:"cherry-ui-elements-init",_target:t("#"+o,s)}))},setProxyStorage:function(t,e){t&&(this.sessionStorage.optionsTemplate[e]=t,this.sessionStorage.activeShortcode=t),this.devMode||this.setState()},afterShowShortcode:function(e,o){var i,s="";o&&-1===this.openedShortcode.indexOf(e)&&(i=this.sessionStorage.activeShortcode.defaultContent,this.selectedContent?s=this.selectedContent:i&&(s=i),t("#"+e+"-content").val(s),this.openedShortcode.push(e)),t(this.insertButton,this.insertionPopUp).removeAttr("disabled")},insertShortcode:function(){var e,o,i,s,n=this.sessionStorage.activeShortcode,r=n.shortcodeSlug,h=n.pluginSlug,c=h+"-"+r,d=n.enclosing,a=d?"[$1$2]$3[/$1]":"[$1$2]",p=t("form#"+c).serializeArray(),l={},S="",u="";if(p[0]){for(e in p)o=p[e],i=o.name.replace(/\[\S*\]/g,""),"cherry5-is__shortcode-content"!==i&&(l[i]?l[i]+=","+o.value:l[i]=o.value);t.map(l,function(t,e){t&&(S+=" "+e+'="'+t+'"')})}d&&(u=t("#"+c+"-content").val()),s=a.replace(/\$1/g,r).replace(/\$2/g,S).replace(/\$3/g,u),window.wp.media.editor.insert(s)},getState:function(){try{return JSON.parse(sessionStorage.getItem("cherry5-insert-shortcode"))}catch(t){return!1}},setState:function(){try{sessionStorage.setItem("cherry5-insert-shortcode",JSON.stringify(this.sessionStorage))}catch(t){return!1}},show:function(t){t.addClass("show")},hide:function(t){t.removeClass("show")},openSodebar:function(){t(this.sidebar).toggleClass("open")}},e.cherry5InsertShortcode.init()});