!function(e,a){"use strict";a.utilites.namespace("ui_elements.media"),a.ui_elements.media={init:function(){e(document).on("ready",this.render).on("cherry-ui-elements-init",this.render)},render:function(a){var i=a._target?a._target:e("body"),r=e(".cherry-upload-button",i);r.each(function(){var a=e(this),i=a.closest(".cherry-ui-media-wrap"),r={input:e(".cherry-upload-input",i),img_holder:e(".cherry-upload-preview",i),title_text:a.data("title"),multiple:a.data("multi-upload"),library_type:a.data("library-type")},t=wp.media.frames.file_frame=wp.media({title:r.title_text,button:{text:r.title_text},multiple:r.multiple,library:{type:r.library_type}});if(!i.has('input[name*="__i__"]')[0]){a.off("click.cherry-media").on("click.cherry-media",function(){return t.open(),!1}),t.on("select",function(){var a=t.state().get("selection").toJSON(),i=0,s="",c=e(".cherry-all-images-wrap",r.img_holder),n="",l="";for(r.multiple&&(s=r.input.val(),l=",",n=c.html());a[i];){var o=a[i],d=o.id,p=o.mime,m="",u="";switch(p){case"image/jpeg":case"image/png":case"image/gif":void 0!==o.sizes&&(m=o.sizes.thumbnail?o.sizes.thumbnail.url:o.sizes.full.url),u='<img  src="'+m+'" alt="" data-img-attr="'+d+'">';break;case"image/x-icon":u='<span class="dashicons dashicons-format-image"></span>';break;case"video/mpeg":case"video/mp4":case"video/quicktime":case"video/webm":case"video/ogg":u='<span class="dashicons dashicons-format-video"></span>';break;case"audio/mpeg":case"audio/wav":case"audio/ogg":u='<span class="dashicons dashicons-format-audio"></span>'}n+='<div class="cherry-image-wrap"><div class="inner"><div class="preview-holder"  data-id-attr="'+d+'"><div class="centered">'+u+'</div></div><a class="cherry-remove-image" href="#"><i class="dashicons dashicons-no"></i></a><span class="title">'+o.title+"</span></div></div>",s+=l+d,i++}r.input.val(s.replace(/(^,)/,"")).trigger("change"),c.html(n)});var s=function(a){var i=a.closest(".cherry-ui-media-wrap"),r=e(".cherry-upload-input",i),t=a.parent().parent(".cherry-image-wrap"),s=e(".preview-holder",t).data("id-attr"),c=r.attr("value"),n=new RegExp(""+s+"(,*)","i");c=c.replace(n,""),c=c.replace(/(,$)/,""),r.attr({value:c}).trigger("change"),t.remove()};i.on("click",".cherry-remove-image",function(){return s(e(this)),!1})}}),e(".cherry-all-images-wrap",i).sortable({items:"div.cherry-image-wrap",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"cherry-media-thumb-sortable-placeholder",start:function(){},stop:function(){},update:function(){var a="";e(".cherry-image-wrap",this).each(function(){var i=e(".preview-holder",this).data("id-attr");a=a+i+","}),a=a.substr(0,a.lastIndexOf(",")),e(this).parent().siblings(".cherry-element-wrap").find("input.cherry-upload-input").val(a).trigger("change")}})}},a.ui_elements.media.init()}(jQuery,window.CherryJsCore);